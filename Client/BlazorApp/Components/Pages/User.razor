@page "/User"
@using ApiContracts
@using BlazorApp.Services
@inject HttpUserService HttpUserService
@rendermode InteractiveServer  
<PageTitle>User</PageTitle>
<h3>Add New User</h3>
  
<ol>
    <li> 
        <input @bind = "_username" placeholder = "Enter username" />
        <input type = "password" @bind ="_password" placeholder="Enter password" /> 
        <button @onclick ="AddUser">Add User</button>
        <p style="color: red">@_errorMessage</p>
        <p style="color: green" hidden="@(_isSuccess == false)"> User added successfully</p>
    </li>
</ol>


@code {
    private string? _username;
    private string? _password; 
    private string? _errorMessage;  
    private bool _isSuccess;  

    private async Task AddUser()
    {
        _errorMessage = string.Empty;
        _isSuccess = false;

        if (string.IsNullOrWhiteSpace(_username) || string.IsNullOrWhiteSpace(_password))
        {
            _errorMessage = "Username and Password cannot be empty.";
            return;
        }

        try
        {
            var newUser = new CreateUserDto
            {   
                UserName = _username,
                Password = _password
            };
            await HttpUserService.AddUserAsync(newUser);

            _isSuccess = true;
        }
        catch (Exception e)
        {
            _errorMessage = $"An error occured: {e.Message}";
        }
    }
}

